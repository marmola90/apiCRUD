import{r as m,j as o,f as z,h as K,B as $,M as F,L as J}from"./index-adcb4964.js";import{a as L,G as q,d as X,P as y,b as S,D as Q,c as Y,R as b,T as D,e as O,f as Z,h as ee,i as se,p as te,S as E}from"./DireccionesPrivadas-43585d96.js";import{S as w}from"./SnackBar.component-7f1a7e29.js";import{A as oe,B as re,u as ae,a as G,T as ie}from"./constants-bb1e5110.js";const R=oe,ne=R+"v1/xnetRoutes/getAllVersionCapturadores",de=R+"v1/xnetRoutes/insertVersionCapturador",ce=R+"v1/xnetRoutes/updateVersionCapturadores",le=async()=>await fetch(ne,{headers:L()}),ue=async i=>{const{TABLA:n,CODIGO:d,DESCRIPCION:a,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:I,LoginPorInstitucion:p,Imagen:r,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(de,{method:"post",headers:L(),body:JSON.stringify({TABLA:n,CODIGO:d,DESCRIPCION:a,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:I,LoginPorInstitucion:p,Imagen:r,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},he=async i=>{const{TABLA:n,CODIGO:d,DESCRIPCION:a,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:I,LoginPorInstitucion:p,Imagen:r,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(ce,{method:"put",headers:L(),body:JSON.stringify({TABLA:n,CODIGO:d,DESCRIPCION:a,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:I,LoginPorInstitucion:p,Imagen:r,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},pe=i=>{const{setRows:n,setRowModesModel:d,rows:a,permisos:c}=i,[u,h]=m.useState(null),I=()=>h(null),p=()=>{if(c.includes(y.Insertar)){const r=a[a.length-1].ID+1;n(l=>[{ID:r,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:"",IdOrdenCategoria:0,isNew:!0},...l]),d(l=>({...l,[r]:{mode:S.Edit,fieldToFocus:"TABLA"}}))}else h({children:"Usuario no autorizado ",severity:"warning"})};return o.jsxs(q,{children:[o.jsx(re,{color:"primary",startIcon:o.jsx(X,{}),onClick:p,children:"Agregar Registro"}),!!u&&o.jsx(w,{snackbar:u,onClose:I})]})},T=[{ID:0,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:""}],ge=()=>{const[i,n]=m.useState(T),[d,a]=m.useState({}),[c,u]=m.useState([]),h=z(),I=ae(),[p,r]=m.useState(null),[l,C]=m.useState(!1),g=K(e=>e.user),A=()=>r(null),x=m.useCallback(e=>{r({children:e.message,severity:"error"})},[]),v=(e,s)=>{e.reason===Y.rowFocusOut&&(s.defaultMuiPrevented=!0)},P=e=>()=>{c.includes(y.Actualizar)?a({...d,[e]:{mode:S.Edit}}):r({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},j=e=>()=>{a({...d,[e]:{mode:S.View,ignoreModifications:!0}}),i.find(t=>t.ID===e).isNew&&n(i.filter(t=>t.ID!==e))},N=e=>{e===E.SESSION_NO_VALIDA&&(n(T),h(`/${F.LOGIN}`,{replace:!0}),I(J()))},V=e=>()=>{a({...d,[e]:{mode:S.View}})},M=async e=>{e.CODIGO!==""&&e.TABLA!==""?await ue(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?r({children:s.data.ErrorDetail,severity:"error"}):r({children:"Registro insertado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===E.SESSION_NO_VALIDA&&N(t)}):r({children:"Campos TABLA y CODIGOS vacÃ­os.",severity:"warning"})},k=async e=>{await he(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?r({children:s.data.ErrorDetail,severity:"error"}):r({children:"Registro actualizado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===E.SESSION_NO_VALIDA&&N(t)})},B=e=>{const s={...e,isNew:!1};return e.isNew?M(e):k(e),n(i.map(t=>t.ID===e.ID?s:t)),s},_=e=>{c.includes(y.Actualizar)?a(e):r({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},U=[{field:"TABLA",headerName:"Tabla",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string",preProcessEditCellProps:e=>{const s=e.id!==""&&e.props.value!==e.row.TABLA?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:b},{field:"CODIGO",headerName:"Codigo",flex:1,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"string",preProcessEditCellProps:e=>{console.log(e);const s=e.id!==""&&e.props.value!==e.row.CODIGO?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:b},{field:"DESCRIPCION",headerName:"Descripcion",flex:1,minWidth:200,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"VERSION",headerName:"Version",headerClassName:"headerGrid",flex:.5,minWidth:80,editable:!0,type:"string"},{field:"ACTIVO",headerName:"Activo",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string"},{field:"LINK",headerName:"Link",headerClassName:"headerGrid",editable:!0,type:"string"},{field:"SIGLAS",headerName:"Siglas",headerClassName:"headerGrid",editable:!0,minWidth:100,flex:.5,type:"string"},{field:"LoginPorInstitucion",headerName:"Login Por Institucion",flex:1,minWidth:140,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"Imagen",headerName:"Imagen",headerClassName:"headerGrid",editable:!0,flex:1,type:"string"},{field:"ReportaDatos",headerName:"Reporta Datos",flex:.5,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"AccesoAInstituciones",headerName:"Acceso A Instituciones",flex:.5,minWidth:155,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"DescripcionHTML",headerName:"Descripcion HTML",width:150,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"AccesoTipoInstitucion",headerName:"Acceso Tipo Institucion",flex:.5,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"actions",type:"actions",headerName:"Actions ",flex:.1,minWidth:100,cellClassName:"actions",headerClassName:"headerGrid",getActions:({id:e})=>{var t;return((t=d[e])==null?void 0:t.mode)===S.Edit?[o.jsx(D,{title:"Guardar",children:o.jsx(O,{icon:o.jsx(Z,{}),label:"Save",sx:{color:"#3A833A"},onClick:V(e)})}),o.jsx(D,{title:"Cancelar",children:o.jsx(O,{icon:o.jsx(ee,{}),label:"Cancel",onClick:j(e),sx:{color:"darkred"}})})]:[o.jsx(D,{title:"Editar",children:o.jsx(O,{icon:o.jsx(se,{sx:{color:"#1d8df8"}}),label:"Edit",className:"textPrimary",onClick:P(e)})})]}}],W=async()=>{await le().then(e=>e.json()).then(e=>{n(e.data),C(!1)}).catch(e=>{const s=e.message.match("SESSION_NO_VALIDA");console.log(e),N(s==null?void 0:s[0])})},H=async e=>{await te(e).then(s=>s.json()).then(s=>{if(s.status==="Error")r({children:s.data.ErrorDetail,severity:"error"});else{const t=s.data.map(f=>f.Id);u(t)}}).catch(s=>{const t=s.message.match("SESSION_NO_VALIDA");console.log(s),N(t==null?void 0:t[0])})};return m.useEffect(()=>{C(!0),W(),H(g.datos.IDPerfil);let e=0;console.log(e++)},[]),o.jsx(G,{container:!0,spacing:1,flexDirection:"column",sx:{marginLeft:"1rem",background:"#fafafa",borderRadius:"25px",padding:"25px"},justifyContent:"space-around",alignItems:"center",children:o.jsxs(G,{item:!0,xs:!0,lg:!0,sm:!0,md:!0,sx:{width:"100%","& .headerGrid":{backgroundColor:"rgb(14 14 14 / 87%)",color:"white"},"& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"},"& .css-1j7qk7u":{color:"#fafafa"},"& .css-1pe4mpk-MuiButtonBase-root-MuiIconButton-root":{color:"rgb(245 245 245 / 54%)"},borderRadius:"25px"},children:[o.jsx(ie,{variant:"h2",gutterBottom:!0,color:"#353535de",children:"XNET TABLAS"}),o.jsxs($,{sx:{height:700},children:[o.jsx(Q,{columns:U,rows:i,editMode:"row",getRowId:e=>e.ID,sx:{boxShadow:5,borderRadius:"25px"},rowModesModel:d,onRowModesModelChange:_,onRowEditStop:v,processRowUpdate:B,onProcessRowUpdateError:x,slots:{toolbar:pe},slotProps:{toolbar:{setRows:n,setRowModesModel:a,rows:i,permisos:c}},loading:l}),!!p&&o.jsx(w,{snackbar:p,onClose:A})]})]})})};export{ge as default};
