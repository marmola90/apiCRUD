import{r as I,j as a,e as W,g as z,I as K,H as $}from"./index-797e622d.js";import{a as E,G as F,d as J,P as y,b as S,D as q,c as X,R as L,e as D,f as Q,h as Y,i as Z,p as ee,S as O}from"./DireccionesPrivadas-43de6e82.js";import{A as se,c as te,S as w,u as oe,a as b,T as ae,B as re}from"./Tab.components-4e986fc4.js";import"./index-289dbd7d.js";const R=se,ie=R+"v1/xnetRoutes/getAllVersionCapturadores",ne=R+"v1/xnetRoutes/insertVersionCapturador",de=R+"v1/xnetRoutes/updateVersionCapturadores",ce=async()=>await fetch(ie,{headers:E()}),le=async i=>{const{TABLA:n,CODIGO:d,DESCRIPCION:r,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:m,LoginPorInstitucion:p,Imagen:o,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(ne,{method:"post",headers:E(),body:JSON.stringify({TABLA:n,CODIGO:d,DESCRIPCION:r,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:m,LoginPorInstitucion:p,Imagen:o,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},ue=async i=>{const{TABLA:n,CODIGO:d,DESCRIPCION:r,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:m,LoginPorInstitucion:p,Imagen:o,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(de,{method:"put",headers:E(),body:JSON.stringify({TABLA:n,CODIGO:d,DESCRIPCION:r,VERSION:c,ACTIVO:u,LINK:h,SIGLAS:m,LoginPorInstitucion:p,Imagen:o,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},he=i=>{const{setRows:n,setRowModesModel:d,rows:r,permisos:c}=i,[u,h]=I.useState(null),m=()=>h(null),p=()=>{if(c.includes(y.Insertar)){const o=r[r.length-1].ID+1;n(l=>[{ID:o,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:"",IdOrdenCategoria:0,isNew:!0},...l]),d(l=>({...l,[o]:{mode:S.Edit,fieldToFocus:"TABLA"}}))}else h({children:"Usuario no autorizado ",severity:"warning"})};return a.jsxs(F,{children:[a.jsx(te,{color:"primary",startIcon:a.jsx(J,{}),onClick:p,children:"Agregar Registro"}),!!u&&a.jsx(w,{snackbar:u,onClose:m})]})},G=[{ID:0,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:""}],Ce=()=>{const[i,n]=I.useState(G),[d,r]=I.useState({}),[c,u]=I.useState([]),h=W(),m=oe(),[p,o]=I.useState(null),[l,C]=I.useState(!1),g=z(e=>e.user),A=()=>o(null),x=I.useCallback(e=>{o({children:e.message,severity:"error"})},[]),T=(e,s)=>{e.reason===X.rowFocusOut&&(s.defaultMuiPrevented=!0)},v=e=>()=>{c.includes(y.Actualizar)?r({...d,[e]:{mode:S.Edit}}):o({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},P=e=>()=>{r({...d,[e]:{mode:S.View,ignoreModifications:!0}}),i.find(t=>t.ID===e).isNew&&n(i.filter(t=>t.ID!==e))},N=e=>{e===O.SESSION_NO_VALIDA&&(n(G),h(`/${K.LOGIN}`,{replace:!0}),m($()))},V=e=>()=>{r({...d,[e]:{mode:S.View}})},j=async e=>{e.CODIGO!==""&&e.TABLA!==""?await le(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?o({children:s.data.ErrorDetail,severity:"error"}):o({children:"Registro insertado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===O.SESSION_NO_VALIDA&&N(t)}):o({children:"Campos TABLA y CODIGOS vacÃ­os.",severity:"warning"})},k=async e=>{await ue(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?o({children:s.data.ErrorDetail,severity:"error"}):o({children:"Registro actualizado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===O.SESSION_NO_VALIDA&&N(t)})},M=e=>{const s={...e,isNew:!1};return e.isNew?j(e):k(e),n(i.map(t=>t.ID===e.ID?s:t)),s},B=e=>{c.includes(y.Actualizar)?r(e):o({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},_=[{field:"TABLA",headerName:"Tabla",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string",preProcessEditCellProps:e=>{const s=e.id!==""&&e.props.value!==e.row.TABLA?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:L},{field:"CODIGO",headerName:"Codigo",flex:1,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"string",preProcessEditCellProps:e=>{console.log(e);const s=e.id!==""&&e.props.value!==e.row.CODIGO?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:L},{field:"DESCRIPCION",headerName:"Descripcion",flex:1,minWidth:200,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"VERSION",headerName:"Version",headerClassName:"headerGrid",flex:.5,minWidth:80,editable:!0,type:"string"},{field:"ACTIVO",headerName:"Activo",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string"},{field:"LINK",headerName:"Link",headerClassName:"headerGrid",editable:!0,type:"string"},{field:"SIGLAS",headerName:"Siglas",headerClassName:"headerGrid",editable:!0,minWidth:100,flex:.5,type:"string"},{field:"LoginPorInstitucion",headerName:"Login Por Institucion",flex:1,minWidth:140,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"Imagen",headerName:"Imagen",headerClassName:"headerGrid",editable:!0,flex:1,type:"string"},{field:"ReportaDatos",headerName:"Reporta Datos",flex:.5,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"AccesoAInstituciones",headerName:"Acceso A Instituciones",flex:.5,minWidth:155,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"DescripcionHTML",headerName:"Descripcion HTML",width:150,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"AccesoTipoInstitucion",headerName:"Acceso Tipo Institucion",flex:.5,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"actions",type:"actions",headerName:"Actions ",flex:.1,minWidth:100,cellClassName:"actions",headerClassName:"headerGrid",getActions:({id:e})=>{var t;return((t=d[e])==null?void 0:t.mode)===S.Edit?[a.jsx(D,{icon:a.jsx(Q,{}),label:"Save",sx:{color:"primary.main"},onClick:V(e)}),a.jsx(D,{icon:a.jsx(Y,{}),label:"Cancel",onClick:P(e),sx:{color:"darkred"}})]:[a.jsx(D,{icon:a.jsx(Z,{sx:{color:"#1d8df8"}}),label:"Edit",className:"textPrimary",onClick:v(e),color:"inherit"})]}}],U=async()=>{await ce().then(e=>e.json()).then(e=>{n(e.data),C(!1)}).catch(e=>{const s=e.message.match("SESSION_NO_VALIDA");console.log(e),N(s==null?void 0:s[0])})},H=async e=>{await ee(e).then(s=>s.json()).then(s=>{if(s.status==="Error")o({children:s.data.ErrorDetail,severity:"error"});else{const t=s.data.map(f=>f.Id);u(t)}}).catch(s=>{const t=s.message.match("SESSION_NO_VALIDA");console.log(s),N(t==null?void 0:t[0])})};return I.useEffect(()=>{C(!0),U(),H(g.datos.IDPerfil);let e=0;console.log(e++)},[]),a.jsx(b,{container:!0,spacing:1,flexDirection:"column",sx:{marginLeft:"1rem",background:"#fafafa",borderRadius:"25px",padding:"25px"},justifyContent:"space-around",alignItems:"center",children:a.jsxs(b,{item:!0,xs:12,sx:{width:"100%","& .headerGrid":{backgroundColor:"rgb(14 14 14 / 87%)",color:"white"},"& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"},"& .css-1j7qk7u":{color:"#fafafa"},"& .css-1pe4mpk-MuiButtonBase-root-MuiIconButton-root":{color:"rgb(245 245 245 / 54%)"},borderRadius:"25px"},children:[a.jsx(ae,{variant:"h2",gutterBottom:!0,color:"#353535de",children:"XNET TABLAS"}),a.jsxs(re,{sx:{height:700},children:[a.jsx(q,{columns:_,rows:i,editMode:"row",getRowId:e=>e.ID,sx:{boxShadow:5,borderRadius:"25px"},rowModesModel:d,onRowModesModelChange:B,onRowEditStop:T,processRowUpdate:M,onProcessRowUpdateError:x,slots:{toolbar:he},slotProps:{toolbar:{setRows:n,setRowModesModel:r,rows:i,permisos:c}},loading:l}),!!p&&a.jsx(w,{snackbar:p,onClose:A})]})]})})};export{Ce as default};
