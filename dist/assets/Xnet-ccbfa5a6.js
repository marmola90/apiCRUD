import{H as y,A as F,r as u,h as X,g as q,x as Q,j as o,k as b,I as Y,S as Z,B as ee,J as se,K as T,M as te,O as L,Q as w,U as S,V as O,W as D,X as oe,Y as ae,Z as re,$ as ie,a0 as E,z as ne,y as ce,a1 as de,n as le,a2 as ue}from"./index-f6950337.js";const R=F,he=R+"v1/xnetRoutes/getAllVersionCapturadores",pe=R+"v1/xnetRoutes/insertVersionCapturador",Ie=R+"v1/xnetRoutes/updateVersionCapturadores",me=async()=>await fetch(he,{headers:y()}),fe=async i=>{const{TABLA:n,CODIGO:c,DESCRIPCION:r,VERSION:d,ACTIVO:h,LINK:p,SIGLAS:m,LoginPorInstitucion:I,Imagen:a,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(pe,{method:"post",headers:y(),body:JSON.stringify({TABLA:n,CODIGO:c,DESCRIPCION:r,VERSION:d,ACTIVO:h,LINK:p,SIGLAS:m,LoginPorInstitucion:I,Imagen:a,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},Ce=async i=>{const{TABLA:n,CODIGO:c,DESCRIPCION:r,VERSION:d,ACTIVO:h,LINK:p,SIGLAS:m,LoginPorInstitucion:I,Imagen:a,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A}=i;return await fetch(Ie,{method:"put",headers:y(),body:JSON.stringify({TABLA:n,CODIGO:c,DESCRIPCION:r,VERSION:d,ACTIVO:h,LINK:p,SIGLAS:m,LoginPorInstitucion:I,Imagen:a,ReportaDatos:l,AccesoAInstituciones:C,DescripcionHTML:g,AccesoTipoInstitucion:A})})},G=[{ID:0,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:""}],Se=()=>{const[i,n]=u.useState(G),[c,r]=u.useState({}),[d,h]=u.useState([]),p=X(),m=q(),[I,a]=u.useState(null),[l,C]=u.useState(!1),g=Q(e=>e.user),[A,x]=u.useState(""),v=()=>a(null),j=u.useCallback(e=>{a({children:e.message,severity:"error"})},[]),P=(e,s)=>{e.reason===te.rowFocusOut&&(s.defaultMuiPrevented=!0)},V=e=>()=>{d.includes(L.Actualizar)?r({...c,[e]:{mode:S.Edit}}):a({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},k=e=>()=>{r({...c,[e]:{mode:S.View,ignoreModifications:!0}}),i.find(t=>t.ID===e).isNew&&n(i.filter(t=>t.ID!==e))},N=e=>{e===E.SESSION_NO_VALIDA&&(n(G),p(`/${ne.LOGIN}`,{replace:!0}),m(ce()))},M=e=>()=>{r({...c,[e]:{mode:S.View}})},B=async e=>{e.CODIGO!==""&&e.TABLA!==""?await fe(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?a({children:s.data.ErrorDetail,severity:"error"}):a({children:"Registro insertado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===E.SESSION_NO_VALIDA&&N(t)}):a({children:"Campos TABLA y CODIGOS vacÃ­os.",severity:"warning"})},_=async e=>{await Ce(e).then(s=>s.json()).then(s=>{console.log(s),s.status==="Error"?a({children:s.data.ErrorDetail,severity:"error"}):a({children:"Registro actualizado.",severity:"success"})}).catch(s=>{var f;const t=(f=s.message.match("SESSION_NO_VALIDA"))==null?void 0:f[0];t===E.SESSION_NO_VALIDA&&N(t)})},U=e=>{const s={...e,isNew:!1};return e.isNew?B(e):_(e),n(i.map(t=>t.ID===e.ID?s:t)),s},W=e=>{d.includes(L.Actualizar)?r(e):a({variant:"filled",children:"Usuario no autorizado.",severity:"warning"})},H=[{field:"TABLA",headerName:"Tabla",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string",preProcessEditCellProps:e=>{const s=e.id!==""&&e.props.value!==e.row.TABLA?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:w},{field:"CODIGO",headerName:"Codigo",flex:1,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"string",preProcessEditCellProps:e=>{console.log(e);const s=e.id!==""&&e.props.value!==e.row.CODIGO?"Campo llave no se puede modificar":!1;return{...e.props,error:s}},renderEditCell:w},{field:"DESCRIPCION",headerName:"Descripcion",flex:1,minWidth:200,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"VERSION",headerName:"Version",headerClassName:"headerGrid",flex:.5,minWidth:80,editable:!0,type:"string"},{field:"ACTIVO",headerName:"Activo",headerClassName:"headerGrid",editable:!0,flex:.5,type:"string"},{field:"LINK",headerName:"Link",headerClassName:"headerGrid",editable:!0,type:"string"},{field:"SIGLAS",headerName:"Siglas",headerClassName:"headerGrid",editable:!0,minWidth:100,flex:.5,type:"string"},{field:"LoginPorInstitucion",headerName:"Login Por Institucion",flex:1,minWidth:140,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"Imagen",headerName:"Imagen",headerClassName:"headerGrid",editable:!0,flex:1,type:"string"},{field:"ReportaDatos",headerName:"Reporta Datos",flex:.5,minWidth:120,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"AccesoAInstituciones",headerName:"Acceso A Instituciones",flex:.5,minWidth:155,headerClassName:"headerGrid",editable:!0,type:"boolean"},{field:"DescripcionHTML",headerName:"Descripcion HTML",width:150,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"AccesoTipoInstitucion",headerName:"Acceso Tipo Institucion",flex:.5,headerClassName:"headerGrid",editable:!0,type:"string"},{field:"actions",type:"actions",headerName:"Actions ",flex:.1,minWidth:100,cellClassName:"actions",headerClassName:"headerGrid",getActions:({id:e})=>{var t;return((t=c[e])==null?void 0:t.mode)===S.Edit?[o.jsx(O,{title:"Guardar",children:o.jsx(D,{icon:o.jsx(oe,{}),label:"Save",sx:{color:"#3A833A"},onClick:M(e)})}),o.jsx(O,{title:"Cancelar",children:o.jsx(D,{icon:o.jsx(ae,{}),label:"Cancel",onClick:k(e),sx:{color:"darkred"}})})]:[o.jsx(O,{title:"Editar",children:o.jsx(D,{icon:o.jsx(re,{sx:{color:"#1d8df8"}}),label:"Edit",className:"textPrimary",onClick:V(e)})})]}}],z=async()=>{await me().then(e=>e.json()).then(e=>{console.log({datos:e}),n(e.data),C(!1)}).catch(e=>{const s=e.message.match("SESSION_NO_VALIDA");console.log(e),N(s==null?void 0:s[0])})},K=async e=>{await ie(e).then(s=>s.json()).then(s=>{if(s.status==="Error")a({children:s.data.ErrorDetail,severity:"error"});else{const t=s.data.map(f=>f.Id);h(t)}}).catch(s=>{const t=s.message.match("SESSION_NO_VALIDA");console.log(s),N(t==null?void 0:t[0])})},$=e=>{x(e.target.value)},J=i.filter(e=>e.CODIGO.toLocaleLowerCase().includes(A.toLocaleLowerCase()));return u.useEffect(()=>{C(!0),z(),K(g.datos.IDPerfil);let e=0;console.log(e++)},[]),o.jsx(b,{container:!0,spacing:1,flexDirection:"column",sx:{marginLeft:"1rem",background:"#fafafa",borderRadius:"25px",padding:"25px"},justifyContent:"space-around",alignItems:"center",children:o.jsxs(b,{item:!0,xs:!0,lg:!0,sm:!0,md:!0,sx:{width:"100%","& .headerGrid":{backgroundColor:"rgb(14 14 14 / 87%)",color:"white"},"& .actions":{color:"text.secondary"},"& .textPrimary":{color:"text.primary"},"& .css-1j7qk7u":{color:"#fafafa"},"& .css-1pe4mpk-MuiButtonBase-root-MuiIconButton-root":{color:"rgb(245 245 245 / 54%)"},borderRadius:"25px"},children:[o.jsx(Y,{variant:"h2",gutterBottom:!0,color:"#353535de",children:"XNET TABLAS"}),o.jsx(Z,{placeholder:"Buscar...",onSearchChange:$}),o.jsxs(ee,{sx:{height:700,mt:5},children:[o.jsx(se,{columns:H,rows:J,editMode:"row",getRowId:e=>e.ID,sx:{boxShadow:5,borderRadius:"25px"},rowModesModel:c,onRowModesModelChange:W,onRowEditStop:P,processRowUpdate:U,onProcessRowUpdateError:j,slots:{toolbar:ge},slotProps:{toolbar:{setRows:n,setRowModesModel:r,rows:i,permisos:d}},loading:l}),!!I&&o.jsx(T,{snackbar:I,onClose:v})]})]})})},ge=i=>{const{setRows:n,setRowModesModel:c,rows:r,permisos:d}=i,[h,p]=u.useState(null),m=()=>p(null),I=()=>{if(d.includes(L.Insertar)){const a=r[r.length-1].ID+1;n(l=>[{ID:a,TABLA:"",CODIGO:"",DESCRIPCION:"",VERSION:"",ACTIVO:"",LINK:"",SIGLAS:"",LoginPorInstitucion:!1,Imagen:"",ReportaDatos:!1,AccesoAInstituciones:!1,DescripcionHTML:"",AccesoTipoInstitucion:"",IdOrdenCategoria:0,isNew:!0},...l]),c(l=>({...l,[a]:{mode:S.Edit,fieldToFocus:"TABLA"}}))}else p({children:"Usuario no autorizado ",severity:"warning"})};return o.jsxs(de,{children:[o.jsx(le,{color:"primary",startIcon:o.jsx(ue,{}),onClick:I,children:"Agregar Registro"}),!!h&&o.jsx(T,{snackbar:h,onClose:m})]})};export{Se as default};
